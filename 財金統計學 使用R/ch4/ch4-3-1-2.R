# Daily TSMC
# 1/4/2000-7/10/2014
tsmc = read.table("c:\\meiyih\\finstats\\ch4\\tsmc.txt", header=T)
attach(tsmc)
names(tsmc)
tsmc.r = 100*diff(log(收盤價))
# Convex and Concave curves
windows()
par(mfrow=c(2,2))
x = seq(0, 1, by=0.01)
y = x^2
plot(x, y, type="l", main="(a) 凸",lwd=2)
y = x/(2+5*x)
plot(x, y, type="l", main="(b) 凹",lwd=2)
x = seq(0, 10, 0.1)
y = 100/(1+90*exp(-x))
plot(x, y, type="l", main="(c) 凸凹",lwd=2)
y = 2+4*x-0.6*x^2+0.04*x^3
plot(x, y, type="l", main="(d) 凹凸",lwd=2)

# 模擬出偏且高峰的觀察值
library(fGarch)
x = seq(-6,6,length=1000)
windows()
par(mfrow=c(2,4))
T = 5000
set.seed(1234)
plot(x,dsstd(x,nu=3,xi=2.5), type="l",ylab="", main="右偏且高峰",lwd=2)
lines(x,dnorm(x),lty=2,col="red",lwd=2)
set.seed(1234)
plot(x,dstd(x,nu=3), type="l",ylab="", main="不偏但高峰",lwd=2)
lines(x,dnorm(x),lty=2,col="red",lwd=2)
set.seed(1234)
plot(-x,-dsstd(x,nu=3,xi=-2.5), type="l",ylab="", main="左偏且高峰",lwd=2)
lines(x,dnorm(x),lty=2,col="red",lwd=2)
plot(x,dunif(x,min(x),max(x)),type="l",ylab="",main="低峰",ylim=c(0,0.4),lwd=2)
lines(x,dnorm(x),lty=2,col="red",lwd=2)

set.seed(1234)
x0 = rstd(T,nu=3)
x0 = (x0-mean(x0))/sd(x0)
basicStats(x0)
set.seed(1234)
x1 = rsstd(T,xi=2.5,nu=3)
x1 = (x1-mean(x1))/sd(x1)
basicStats(x1)
set.seed(1234)
x2 = rsstd(T,xi=-2.5,nu=3)
x2 = (x2-mean(x2))/sd(x2)
basicStats(x2)
set.seed(1234)
x3 = runif(T,min(x),max(x))
x3 = (x3-mean(x3))/sd(x3)
basicStats(x3)
quantile(x0,c(0.001,0.25,0.75,0.995))
quantile(x1,c(0.001,0.25,0.75,0.995))
quantile(x2,c(0.001,0.25,0.75,0.995))
quantile(x3,c(0.001,0.25,0.75,0.995))
qnorm(c(0.001,0.25,0.75,0.995))
qqnorm(x1,datax=T,ylim=c(-10,10),lwd=2)
qqline(x1,datax=T,lwd=2)
qqnorm(x0,datax=T,ylim=c(-10,10),lwd=2)
qqline(x0,datax=T,lwd=2)
qqnorm(x2,datax=T,ylim=c(-10,10),lwd=2)
qqline(x2,datax=T,lwd=2)
qqnorm(x3,datax=T,lwd=2)
qqline(x3,datax=T,lwd=2)

qnorm(c(0.001,0.25,0.75,0.995))

# QQ-plot
?qqnorm
z.tsmc = (tsmc.r-mean(tsmc.r))/sd(tsmc.r)
basicStats(z.tsmc)
windows()
par(mfrow=c(2,2))
qqnorm(z.tsmc, datax = T, ylab="實證值",xlab="理論值",main=" k = 1",ylim=c(-5,5),lwd=2)
qqline(z.tsmc, datax = T, distribution=qnorm,lwd=2)
tsmc.2r = 100*diff(log(收盤價),2)
z.tsmc.2r = (tsmc.2r-mean(tsmc.2r))/sd(tsmc.2r)
basicStats(z.tsmc.2r)
qqnorm(z.tsmc.2r, datax = T, ylab="實證值",xlab="理論值",main=" k = 2",ylim=c(-5,5),lwd=2)
qqline(z.tsmc.2r, datax = T, distribution=qnorm,lwd=2)
tsmc.5r = 100*diff(log(收盤價),5)
z.tsmc.5r = (tsmc.5r-mean(tsmc.5r))/sd(tsmc.5r)
basicStats(z.tsmc.5r)
qqnorm(z.tsmc.5r, datax = T, ylab="實證值",xlab="理論值",main=" k = 5",ylim=c(-5,5),lwd=2)
qqline(z.tsmc.5r, datax = T, distribution=qnorm,lwd=2)
tsmc.10r = 100*diff(log(收盤價),10)
z.tsmc.10r = (tsmc.10r-mean(tsmc.10r))/sd(tsmc.10r)
basicStats(z.tsmc.10r)
qqnorm(z.tsmc.10r, datax = T, ylab="實證值",xlab="理論值",main=" k = 10",ylim=c(-5,5),lwd=2)
qqline(z.tsmc.10r, datax = T, distribution=qnorm,lwd=2)
mtext("TSMC對數報酬率與標準常態分配,k表示保有天數", side = 3, outer=TRUE, line = -1)
windows()
qno = qqnorm(z.tsmc, datax = T, ylab="實證值",xlab="理論值",main=" k = 1",ylim=c(-7,7))       
qqline(z.tsmc, datax=T)
qno
length(qno$x)
qno$x[1:10]
qno$y[1:10]
qno$x[3613:3623]
qno$y[3613:3623]
basicStats(z.tsmc)
